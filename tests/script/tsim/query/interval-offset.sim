system sh/stop_dnodes.sh
system sh/deploy.sh -n dnode1 -i 1
system sh/exec.sh -n dnode1 -s start
sleep 500
sql connect

print =============== create database
sql drop database d0 -x step1
step1:
sql create database d0
sql show databases
if $rows != 1 then 
  return -1
endi

sql use d0

print =============== create super table and child table
sql create table stb (ts timestamp, tbcol int) tags (t1 int)
sql show stables
print $rows $data00 $data01 $data02
if $rows != 1 then 
  return -1
endi

sql create table ct1 using stb tags ( 1 )
sql create table ct2 using stb tags ( 2 )
sql show tables
print $rows $data00 $data10 $data20
if $rows != 2 then
  return -1
endi 

print =============== insert data into child table
sql insert into ct1 values ( '2022-01-01 01:01:01.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:06.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:10.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:16.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:20.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:26.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:30.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:36.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:40.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:46.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:50.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:01:56.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:00.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:06.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:10.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:16.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:20.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:26.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:30.000', 1 )
sql insert into ct1 values ( '2022-01-01 01:02:36.000', 1 )

sql select count(tbcol), sum(tbcol), max(tbcol), min(tbcol), count(*) from ct1 interval(10s, 2s)
print ===> select count(tbcol), sum(tbcol), max(tbcol), min(tbcol), count(*) from ct1 interval(10s, 2s)
print ===> $rows $data00 $data01 $data02 $data03 $data04
if $rows != 10 then
  return -1
endi 
if $data00 != 2 then
  return -1
endi 
if $data04 != 2 then
  return -1
endi 

sql insert into ct2 values ( '2022-01-01 01:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-01 12:00:01.000', 2 )
sql insert into ct2 values ( '2022-01-01 23:00:01.000', 3 )
sql insert into ct2 values ( '2022-01-02 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-03 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-04 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-05 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-06 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-07 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-08 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-09 10:00:01.000', 1 )
sql insert into ct2 values ( '2022-01-10 10:00:01.000', 1 )

sql select count(tbcol), sum(tbcol), max(tbcol), min(tbcol), count(*) from ct2 interval(1d, 2h)
print ===> select count(tbcol), sum(tbcol), max(tbcol), min(tbcol), count(*) from ct2 interval(1d, 2w)
print ===> rows0: $data00 $data01 $data02 $data03 $data04
print ===> rows1: $data10 $data11 $data12 $data13 $data14
print ===> rows2: $data20 $data21 $data22 $data23 $data24
if $rows != 11 then
  return -1
endi 
if $data00 != 1 then
  return -1
endi 
if $data10 != 2 then
  return -1
endi

return

sql select count(*) from car interval(1n, 10d) order by ts desc
#        tdSql.checkData(0, 1, 1)
#        tdSql.checkData(1, 1, 2)
#        tdSql.checkData(2, 1, 3)
#        tdSql.checkData(3, 1, 3)
#        tdSql.checkData(4, 1, 6)
#        tdSql.checkData(5, 1, 1)
#        tdSql.checkData(6, 1, 1)
#
sql select count(*) from car interval(2n, 5d)
#        tdSql.checkData(0, 1, 1)
#        tdSql.checkData(1, 1, 1)
#        tdSql.checkData(2, 1, 6)
#        tdSql.checkData(3, 1, 6)
#        tdSql.checkData(4, 1, 3)

sql select count(*) from car interval(2n) order by ts desc
#        tdSql.checkData(0, 1, 3)
#        tdSql.checkData(1, 1, 6)
#        tdSql.checkData(2, 1, 6)
#        tdSql.checkData(3, 1, 1)
#        tdSql.checkData(4, 1, 1)
#
sql select count(*) from car interval(1y, 1n)
#        tdSql.checkData(0, 1, 1)
#        tdSql.checkData(1, 1, 8)
#        tdSql.checkData(2, 1, 8)
#
sql select count(*) from car interval(1y, 2n)
#        tdSql.checkData(0, 1, 1)
#        tdSql.checkData(1, 1, 11)
#        tdSql.checkData(2, 1, 5)

sql select count(*) from car where ts > '2019-05-14 00:00:00' interval(1y, 5d)
#       tdSql.checkData(0, 1, 6)
#       tdSql.checkData(1, 1, 9)




